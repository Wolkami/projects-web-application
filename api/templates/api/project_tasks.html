{% extends 'api/base.html' %}
{% block title %}–ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞{% endblock %}

{% block content %}
<h2>–ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞: {{ project.title }}</h2>

<div class="mb-3">
    <a href="{% url 'project-view' project.id %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç—É</a>
</div>

<form method="get" class="row g-2 mb-4 align-items-end">
    <div class="col-auto">
        <label for="q" class="form-label">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</label>
        <input type="text"
               name="q"
               id="q"
               value="{{ query|default_if_none:'' }}"
               placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"
               class="form-control">
    </div>

    <div class="col-auto">
        <label for="status" class="form-label">–°—Ç–∞—Ç—É—Å</label>
        <select name="status" id="status" class="form-select">
            <option value="">–í—Å–µ</option>
            {% for value, label in Task.Status.choices %}
                <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-auto">
        <label for="assignee" class="form-label">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</label>
        <select name="assignee" id="assignee" class="form-select">
            <option value="">–õ—é–±–æ–π</option>
            {% for participant in participants %}
                <option value="{{ participant.user.id }}" {% if assignee_filter == participant.user.id|stringformat:"s" %}selected{% endif %}>
                    {{ participant.user.username }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="col-auto mt-3">
        <button type="submit" class="btn btn-primary">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
    </div>
    <div class="col-auto mt-3">
        <a href="{% url 'project-tasks' project.id %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
    </div>
</form>

<table class="table table-bordered table-striped">
    <thead>
    <tr>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–°—Ä–æ–∫</th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    {% for task in page_obj %}
        <tr>
            <td>{{ task.title }}</td>
            <td>{{ task.assignee|default:"‚Äî" }}</td>
            <td>{{ task.get_status_display }}</td>
            <td>{{ task.due_date|default:"‚Äî" }}</td>
            <td>
                <a href="{% url 'task-detail-view' task.id %}" class="btn btn-sm btn-outline-primary">üëÅ</a>
                {% if request.user == project.creator or request.user == task.assignee %}
                    <a href="{% url 'edit-task' task.id %}" class="btn btn-sm btn-outline-secondary">‚úè</a>
                {% endif %}
            </td>
        </tr>
    {% empty %}
        <tr>
            <td colspan="5" class="text-muted text-center">–ù–µ—Ç –∑–∞–¥–∞—á</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
<nav>
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?{% if query %}q={{ query }}&{% endif %}{% if status_filter %}status={{ status_filter }}&{% endif %}{% if assignee_filter %}assignee={{ assignee_filter }}&{% endif %}page={{ page_obj.previous_page_number }}">‚Üê –ù–∞–∑–∞–¥</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">‚Üê –ù–∞–∑–∞–¥</span></li>
        {% endif %}

        <li class="page-item disabled">
            <span class="page-link">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
        </li>

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?{% if query %}q={{ query }}&{% endif %}{% if status_filter %}status={{ status_filter }}&{% endif %}{% if assignee_filter %}assignee={{ assignee_filter }}&{% endif %}page={{ page_obj.next_page_number }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">–í–ø–µ—Ä—ë–¥ ‚Üí</span></li>
        {% endif %}
    </ul>
</nav>
{% endblock %}